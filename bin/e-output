#! /bin/bash

if [[ -f "/Volumes/rdisk/ramdisk-id" ]]; then
    OUTPUT_DIR="/Volumes/rdisk"
else
    OUTPUT_DIR="/tmp"
fi

OUT="$OUTPUT_DIR"/e-output.$$.out
ERR="$OUTPUT_DIR"/e-output.$$.err
exit_code=0

if [ $# -lt 1 ]; then
    cat >"$OUT" 2>"$ERR"
else
    "$@" >"$OUT" 2>"$ERR" || exit_code=1
fi
if [ -s "$ERR" ]; then
    echo '\n\n=======================================================' >> "$ERR"
    cat "$OUT" >> "$ERR"
    rm "$OUT"
else
    mv "$OUT" "$ERR"
fi
~/bin/e "$ERR"
(sleep 120; rm "$ERR") &
exit $exit_code
